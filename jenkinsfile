pipeline {
    agent any

    tools {
        jdk 'Java-17'          // Make sure this matches your Jenkins tool name
        maven 'Maven-3.9'      // Same here
    }

    environment {
        NEXUS_URL = "http://<NEXUS-IP>:8081/repository/maven-releases/"
        NEXUS_REPO_ID = "maven-releases"  // repo ID inside settings.xml / pom.xml
        NEXUS_CREDS = "nexus-creds"       // Jenkins credentials ID
    }

    stages {

        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Build') {
            steps {
                sh 'mvn clean package -DskipTests'
            }
        }

        stage('Upload to Nexus') {
            steps {
                withCredentials([usernamePassword(credentialsId: "${NEXUS_CREDS}", 
                                                 usernameVariable: 'NEXUS_USER', 
                                                 passwordVariable: 'NEXUS_PASS')]) {
                    sh """
                        mvn deploy -DskipTests \
                          -Dnexus.url=${NEXUS_URL} \
                          -Dnexus.repositoryId=${NEXUS_REPO_ID} \
                          -Dnexus.username=${NEXUS_USER} \
                          -Dnexus.password=${NEXUS_PASS}
                    """
                }
            }
        }

        stage('Archive Artifact') {
            steps {
                archiveArtifacts artifacts: 'target/*.jar', fingerprint: true
            }
        }
    }
}
